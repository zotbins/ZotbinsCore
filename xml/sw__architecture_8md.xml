<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.14.0" xml:lang="en-US">
  <compounddef id="sw__architecture_8md" kind="file" language="Markdown">
    <compoundname>sw_architecture.md</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline><highlight class="normal">#<sp/>Software<sp/>Architecture</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#<sp/>Introduction</highlight></codeline>
<codeline><highlight class="normal">The<sp/>purpose<sp/>of<sp/>this<sp/>document<sp/>is<sp/>to<sp/>provide<sp/>a<sp/>detailed<sp/>overview<sp/>of<sp/>the<sp/>software<sp/>architecture<sp/>behind<sp/>the<sp/>new<sp/>ZotBins<sp/>Core,<sp/>focusing<sp/>on<sp/>reliability,<sp/>maintainability,<sp/>and<sp/>efficiency.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>intention<sp/>of<sp/>this<sp/>document<sp/>is<sp/>to<sp/>help<sp/>the<sp/>embedded<sp/>system<sp/>development<sp/>team<sp/>understand<sp/>how<sp/>the<sp/>system<sp/>is<sp/>structured.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#<sp/>Background</highlight></codeline>
<codeline><highlight class="normal">ZotBins<sp/>Core<sp/>is<sp/>a<sp/>IoT<sp/>Smart<sp/>Bin<sp/>to<sp/>keep<sp/>track<sp/>of<sp/>waste<sp/>data<sp/>metrics<sp/>like<sp/>bin<sp/>fullness,<sp/>weight,<sp/>usage<sp/>rates,<sp/>etc.<sp/>This<sp/>is<sp/>intended<sp/>to<sp/>help<sp/>quantify<sp/>waste<sp/>data<sp/>and<sp/>promote<sp/>solutions<sp/>to<sp/>reduce<sp/>the<sp/>amount<sp/>of<sp/>waste<sp/>people<sp/>throw<sp/>away.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>previous<sp/>iteration<sp/>was<sp/>a<sp/>Raspberry<sp/>Pi-based<sp/>system.<sp/>This<sp/>system<sp/>is<sp/>intended<sp/>to<sp/>a<sp/>replacement<sp/>for<sp/>the<sp/>Raspberry<sp/>Pi<sp/>system,<sp/>while<sp/>being<sp/>more<sp/>reliable,<sp/>maintainable,<sp/>efficient,<sp/>and<sp/>testable.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#<sp/>Functional<sp/>Requirements</highlight></codeline>
<codeline><highlight class="normal">Many<sp/>of<sp/>the<sp/>features<sp/>revolve<sp/>around<sp/>the<sp/>various<sp/>sensors<sp/>that<sp/>the<sp/>ZotBins<sp/>Core<sp/>utilize.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">-<sp/>Breakbeam<sp/>Sensor:<sp/>Measure<sp/>the<sp/>amount<sp/>of<sp/>time<sp/>a<sp/>bin<sp/>is<sp/>used<sp/>in<sp/>a<sp/>30<sp/>minute<sp/>time<sp/>period</highlight></codeline>
<codeline><highlight class="normal">-<sp/>Load<sp/>Cell<sp/>&amp;<sp/>HX-711:<sp/>Measure<sp/>the<sp/>weight<sp/>of<sp/>the<sp/>trash<sp/>currently<sp/>in<sp/>the<sp/>bin</highlight></codeline>
<codeline><highlight class="normal">-<sp/>Ultrasonic<sp/>sensor:<sp/>Measure<sp/>the<sp/>current<sp/>fullness<sp/>of<sp/>the<sp/>trash<sp/>can</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Additionally,<sp/>the<sp/>system<sp/>must<sp/>publish<sp/>the<sp/>sensor<sp/>data<sp/>to<sp/>a<sp/>MQTT<sp/>broker<sp/>every<sp/>30<sp/>minutes.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#<sp/>Architecture<sp/>Overview</highlight></codeline>
<codeline><highlight class="normal">ZotBins<sp/>Core<sp/>is<sp/>a<sp/>RTOS<sp/>application,<sp/>where<sp/>each<sp/>function<sp/>is<sp/>divided<sp/>into<sp/>a<sp/>separate<sp/>task<sp/>to<sp/>optimize<sp/>the<sp/>efficiency<sp/>and<sp/>relability<sp/>of<sp/>the<sp/>system.<sp/>Each<sp/>sensor<sp/>has<sp/>its<sp/>own<sp/>task<sp/>and<sp/>in<sp/>the<sp/>off<sp/>chance<sp/>the<sp/>sensor<sp/>fails,<sp/>the<sp/>overall<sp/>system<sp/>can<sp/>still<sp/>function<sp/>as<sp/>intended.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Each<sp/>sensor<sp/>task<sp/>will<sp/>pass<sp/>its<sp/>sensor<sp/>data<sp/>to<sp/>the<sp/>MQTT<sp/>task<sp/>through<sp/>a<sp/>thread-safe<sp/>queue,<sp/>so<sp/>the<sp/>MQTT<sp/>Task<sp/>can<sp/>publish<sp/>its<sp/>sensor<sp/>data<sp/>to<sp/>the<sp/>MQTT<sp/>broker.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">This<sp/>system<sp/>of<sp/>having<sp/>a<sp/>task<sp/>for<sp/>each<sp/>sensor<sp/>makes<sp/>the<sp/>system<sp/>more<sp/>maintainable<sp/>due<sp/>to<sp/>separation<sp/>of<sp/>concerns.<sp/>The<sp/>fullness<sp/>task<sp/>does<sp/>not<sp/>need<sp/>to<sp/>worry<sp/>about<sp/>the<sp/>state<sp/>of<sp/>the<sp/>weight<sp/>task<sp/>and<sp/>can<sp/>just<sp/>focus<sp/>on<sp/>itself.<sp/>In<sp/>addition,<sp/>the<sp/>system<sp/>is<sp/>more<sp/>extensible<sp/>since<sp/>a<sp/>new<sp/>task<sp/>can<sp/>be<sp/>easily<sp/>added<sp/>to<sp/>the<sp/>system<sp/>without<sp/>interfering<sp/>with<sp/>the<sp/>other<sp/>features.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>Overall<sp/>System<sp/>Diagram<sp/>(more<sp/>detail<sp/>on<sp/>each<sp/>task<sp/>is<sp/>shown<sp/>down<sp/>below)</highlight></codeline>
<codeline><highlight class="normal">\startuml</highlight></codeline>
<codeline><highlight class="normal">:Start;</highlight></codeline>
<codeline><highlight class="normal">-&gt;</highlight></codeline>
<codeline><highlight class="normal">:Initialize<sp/>sensors;</highlight></codeline>
<codeline><highlight class="normal">fork</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>group<sp/>Fullness</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Setup<sp/>fullness<sp/>task;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>while<sp/>(Loop<sp/>forever)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>:Process;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>endwhile</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>detach</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-[hidden]-&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>end<sp/>group</highlight></codeline>
<codeline><highlight class="normal">fork<sp/>again</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>group<sp/>Weight</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Setup<sp/>weight<sp/>task;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>while<sp/>(Loop<sp/>forever)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>:Process;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>endwhile</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>detach</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-[hidden]-&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>end<sp/>group</highlight></codeline>
<codeline><highlight class="normal">fork<sp/>again</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>group<sp/>Usage</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Setup<sp/>usage<sp/>task;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>while<sp/>(Loop<sp/>forever)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>:Process;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>endwhile</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>detach</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-[hidden]-&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>end<sp/>group</highlight></codeline>
<codeline><highlight class="normal">fork<sp/>again</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>group<sp/>WiFi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Setup<sp/>WiFi<sp/>task;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>while<sp/>(Loop<sp/>forever)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>:Process;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>endwhile</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>detach</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-[hidden]-&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>end<sp/>group</highlight></codeline>
<codeline><highlight class="normal">\enduml</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>Fullness<sp/>Task</highlight></codeline>
<codeline><highlight class="normal">The<sp/>Fullness<sp/>Task<sp/>is<sp/>responsible<sp/>for<sp/>measuring<sp/>the<sp/>current<sp/>fullness<sp/>of<sp/>the<sp/>waste<sp/>bin.<sp/>This<sp/>is<sp/>measured<sp/>by<sp/>the<sp/>following<sp/>equation.<sp/>The<sp/>height<sp/>of<sp/>the<sp/>waste<sp/>bin<sp/>should<sp/>be<sp/>hard<sp/>coded<sp/>for<sp/>each<sp/>ZotBins<sp/>Core<sp/>deployment<sp/>as<sp/>each<sp/>bin<sp/>might<sp/>differ<sp/>in<sp/>height.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline><highlight class="normal">Fullness<sp/>%<sp/>=<sp/>(Height<sp/>of<sp/>Bin<sp/>-<sp/>Distance<sp/>measured<sp/>from<sp/>ultrasonic<sp/>sensor)<sp/>/<sp/>Height<sp/>of<sp/>Bin</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">If<sp/>the<sp/>ultrasonic<sp/>sensor<sp/>reads<sp/>an<sp/>invalid<sp/>value,<sp/>it<sp/>should<sp/>log<sp/>the<sp/>error<sp/>and<sp/>return<sp/>a<sp/>error<sp/>value<sp/>like<sp/>`-1`<sp/>so<sp/>the<sp/>MQTT<sp/>thread<sp/>is<sp/>not<sp/>blocked<sp/>waiting<sp/>for<sp/>the<sp/>fullness<sp/>value.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">\startuml</highlight></codeline>
<codeline><highlight class="normal">group<sp/>Fullness<sp/>Task</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Initialize<sp/>task;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>while<sp/>(Loop<sp/>forever)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>:Measure<sp/>Distance;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(Distance<sp/>valid?)<sp/>then<sp/>(yes)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>:Smooth<sp/>value;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>:Push<sp/>value<sp/>to<sp/>queue;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>else<sp/>(no)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>:Push<sp/>error<sp/>value<sp/>to<sp/>queue;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>endif</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Wait<sp/>30<sp/>mins;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>endwhile</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-[hidden]-&gt;</highlight></codeline>
<codeline><highlight class="normal">endgroup</highlight></codeline>
<codeline><highlight class="normal">\enduml</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>Weight<sp/>Task</highlight></codeline>
<codeline><highlight class="normal">The<sp/>Weight<sp/>Task<sp/>is<sp/>responsible<sp/>for<sp/>measuring<sp/>the<sp/>current<sp/>weight<sp/>in<sp/>kilograms<sp/>of<sp/>the<sp/>waste<sp/>bin.<sp/>This<sp/>is<sp/>measured<sp/>using<sp/>load<sp/>cells<sp/>and<sp/>the<sp/>HX711<sp/>load<sp/>cell<sp/>amplifier<sp/>for<sp/>the<sp/>MCU<sp/>to<sp/>read.<sp/></highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">If<sp/>an<sp/>invalid<sp/>weight<sp/>is<sp/>read<sp/>from<sp/>the<sp/>HX711,<sp/>or<sp/>if<sp/>the<sp/>weight<sp/>sensor<sp/>is<sp/>not<sp/>performing<sp/>as<sp/>expected,<sp/>we<sp/>will<sp/>log<sp/>the<sp/>error<sp/>and<sp/>send<sp/>a<sp/>corresponding<sp/>error<sp/>value<sp/>to<sp/>the<sp/>queue,<sp/>so<sp/>the<sp/>MQTT<sp/>thread<sp/>is<sp/>not<sp/>blocked<sp/>waiting<sp/>for<sp/>the<sp/>weight<sp/>value.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">\startuml<sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">group<sp/>Weight<sp/>Task<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Initialize<sp/>task;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>while<sp/>(Loop<sp/>forever)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>:Measure<sp/>Weight;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(Valid<sp/>Weight<sp/>AND<sp/>Sensor<sp/>Working)<sp/>then<sp/>(yes)<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>:Push<sp/>value<sp/>to<sp/>queue;<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>else<sp/>(no)<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>:Push<sp/>error<sp/>value<sp/>to<sp/>queue;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>endif<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>:Wait<sp/>30<sp/>mins;<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>endwhile<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-[hidden]-&gt;</highlight></codeline>
<codeline><highlight class="normal">endgroup<sp/></highlight></codeline>
<codeline><highlight class="normal">\enduml</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>Usage<sp/>Task</highlight></codeline>
<codeline><highlight class="normal">TODO</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>MQTT<sp/>Task</highlight></codeline>
<codeline><highlight class="normal">TODO</highlight></codeline>
    </programlisting>
    <location file="C:/priya/ZotBins/ZotbinsCore/docs/sw_architecture.md"/>
  </compounddef>
</doxygen>
